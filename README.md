# pi-homelab

![Platform](https://img.shields.io/badge/platform-Raspberry%20Pi%20%2F%20ARM64%20%7C%20ARMv7-blue)
![OS](https://img.shields.io/badge/os-Raspberry%20Pi%20OS%20(Debian)-green)
![Compose](https://img.shields.io/badge/docker-compose-v2+-informational)
![License](https://img.shields.io/badge/license-MIT-yellow)

A lightweight, reproducible **Raspberry Pi homelab stack** built around **Docker Compose**.

This repository provides a clean folder structure, ready-to-run Compose files, and a **one-liner installer** that bootstraps a fresh Raspberry Pi OS system.

---

## âœ¨ Included Stacks

- **DNS** (`containers/dns`)  
  **Pi-hole** + **Unbound** (recursive resolver; upstream for Pi-hole)
- **Portainer** (`containers/portainer`)  
  Docker UI
- **Home Assistant** (`containers/homeassistant`)  
  Smart home core (recommended on `network_mode: host`)
- **MQTT** (`containers/mqtt`)  
  **Eclipse Mosquitto** broker
- **Monitoring** (`containers/monitoring`)  
  **InfluxDB 2.x** + **Grafana**

*(Optional later)* **Traefik** (reverse proxy / HTTPS). Intentionally not part of the minimal setup.

---

## ğŸ¯ Goals

- Minimal complexity (easy to understand and maintain)
- Reproducible setup (works the same on every Pi)
- One stack per folder (clear separation)
- Easy to extend (add new stacks without redesign)
- Suitable foundation for Home Assistant + energy monitoring

---

## ğŸ“ Repository Structure

Current layout (simplified):

```text
pi-homelab/
â”œâ”€ README.md
â”œâ”€ install.sh
â”œâ”€ LICENSE
â””â”€ containers/
   â”œâ”€ dns/
   â”‚  â”œâ”€ docker-compose.yml
   â”‚  â”œâ”€ .env.example
   â”‚  â”œâ”€ pihole/
   â”‚  â”‚  â””â”€ etc-pihole/        (persisted data; contains .gitkeep)
   â”‚  â””â”€ unbound/
   â”‚     â””â”€ config/
   â”‚        â””â”€ 00-pihole.conf  (unbound config fragment)
   â”œâ”€ homeassistant/
   â”‚  â”œâ”€ docker-compose.yml
   â”‚  â”œâ”€ .env.example
   â”‚  â””â”€ config/               (contains .gitkeep)
   â”œâ”€ mqtt/
   â”‚  â”œâ”€ docker-compose.yml
   â”‚  â”œâ”€ .env.example
   â”‚  â””â”€ mosquitto/
   â”‚     â”œâ”€ config/mosquitto.conf
   â”‚     â”œâ”€ data/              (contains .gitkeep)
   â”‚     â””â”€ log/               (contains .gitkeep)
   â”œâ”€ monitoring/
   â”‚  â”œâ”€ docker-compose.yml
   â”‚  â”œâ”€ .env.example
   â”‚  â”œâ”€ influxdb/
   â”‚  â”‚  â”œâ”€ config/            (contains .gitkeep)
   â”‚  â”‚  â””â”€ data/              (contains .gitkeep)
   â”‚  â””â”€ grafana/
   â”‚     â””â”€ data/              (contains .gitkeep)
   â””â”€ portainer/
      â””â”€ docker-compose.yml
```

### Why `.gitkeep`?
Git does not track empty directories. We keep bind-mount directories in the repo using `.gitkeep` so the installer can create the same structure reliably on a fresh machine.

---

## ğŸš€ Installation (One-liner)

The installer downloads this repo as a tarball (no `git clone` needed) and installs it to `/opt/pi-homelab`.

```bash
wget -qO- "https://raw.githubusercontent.com/<OWNER>/pi-homelab/main/install.sh" | sudo bash
```

You can override defaults (optional):

```bash
wget -qO- "https://raw.githubusercontent.com/<OWNER>/pi-homelab/main/install.sh" |   sudo REPO_OWNER="<OWNER>" REPO_REF="main" INSTALL_DIR="/opt/pi-homelab" bash
```

---

## ğŸ§° What `install.sh` does

- Installs Docker Engine + Compose plugin (if missing)
- Enables and starts Docker service
- Adds the â€œrealâ€ user to the `docker` group (so you can run docker without sudo)
- Downloads the repo as a tarball and installs/syncs to:
  - **`/opt/pi-homelab`** (default)
- Bootstraps `.env` files:
  - Copies `.env.example` â†’ `.env` **only if `.env` is missing**
- Ensures bind-mount **files** exist (touches missing files if referenced by compose)
- Fixes ownership so day-to-day operations work without sudo:
  - `chown -R <user>:<group> /opt/pi-homelab`

At the end, the script prints the generated / bootstrapped credentials (where applicable).

---

## ğŸ”§ Environment Variables (`.env`)

Each stack may provide a `.env.example`. After install, youâ€™ll find `.env` next to the stack compose file.

### DNS stack (`containers/dns/.env`)
- `PIHOLE_WEBPASSWORD`  
  Password for the Pi-hole admin UI

*(Pi-hole v6 uses `FTLCONF_*` variables inside the compose file; the password is injected from `.env`.)*

### Monitoring stack (`containers/monitoring/.env`)

InfluxDB (initial setup):
- `INFLUXDB_USERNAME` (default: `admin`)
- `INFLUXDB_PASSWORD` (generated by installer if still set to `CHANGEME...`)
- `INFLUXDB_ORG` (e.g. `pi-homelab`)
- `INFLUXDB_BUCKET` (e.g. `homeassistant`)
- `INFLUXDB_ADMIN_TOKEN` (generated by installer if still set to `CHANGEME...`)

Grafana:
- `GRAFANA_ADMIN_USER` (default: `admin`)
- `GRAFANA_ADMIN_PASSWORD` (generated by installer if still set to `CHANGEME...`)

### MQTT stack (`containers/mqtt/.env`)
Usually empty/minimal (depends on your compose). If you add auth later, put credentials here.

### Home Assistant stack (`containers/homeassistant/.env`)
Typically contains:
- `TZ` (e.g. `Europe/Berlin`)

---

## â–¶ï¸ Starting the Stacks

Go into the stack directory and start it:

```bash
cd /opt/pi-homelab/containers/dns
docker compose up -d
docker compose ps
```

Recommended first-time startup order:

1. `dns` (Pi-hole + Unbound)
2. `portainer`
3. `homeassistant`
4. `mqtt`
5. `monitoring` (InfluxDB + Grafana)

Update images later:

```bash
docker compose pull
docker compose up -d
```

---

## ğŸ” Quick Health Checks

Pi-hole UI:
- `http://<pi-ip>/admin`

Portainer:
- `http://<pi-ip>:9000` (or whatever your compose exposes)

DNS tests (from a client using Pi-hole as DNS):
```bash
nslookup heise.de
nslookup ipv6.google.com
```

---

## ğŸ§  Notes on Networking

- **Home Assistant** commonly runs with `network_mode: host` so it can discover devices (mDNS, SSDP, etc.) without extra complexity.
- Other stacks can stay on Dockerâ€™s default bridge network unless you have a reason to segment them.
- If you later introduce Traefik or cross-stack routing, you can add a shared network then.

---

## ğŸ”„ System Updates

### Raspberry Pi OS updates
Run occasionally:
```bash
sudo apt update
sudo apt upgrade -y
```

### Container updates
Per stack:
```bash
docker compose pull
docker compose up -d
```

---

## ğŸ“œ License

This project is licensed under the **MIT License**. See `LICENSE`.

*(License makes sense even for homelab repos because it clarifies reuse/redistribution rules if you share it with others.)*

---

## ğŸ‘¤ Author Notes

Designed for Raspberry Pi OS (Debian-based) and tested on Raspberry Pi 4 booting from SSD.

Happy homelabbing!
